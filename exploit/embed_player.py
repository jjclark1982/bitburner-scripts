import base64
import json
from pathlib import Path
import argparse


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('save_path', type=Path, nargs='?', default='bitburnerSave.json')
    parser.add_argument('player_path', type=Path, nargs='?', default='decodedPlayer.json')
    args = parser.parse_args()

    with args.save_path.open() as f:
        b64_data = f.read()

    json_data = base64.b64decode(b64_data)
    dict_data = json.loads(json_data)
    save_data = dict_data['data']
    PlayerSave = json.loads(save_data['PlayerSave'])

    with args.player_path.open('r') as f:
        PlayerSave = json.load(f)

    save_data['PlayerSave'] = json.dumps(PlayerSave)
    dict_data['data'] = save_data
    json_data = json.dumps(dict_data).encode('ascii')
    b64_data = base64.b64encode(json_data).decode('ascii')

    output_path = args.save_path.with_name(args.save_path.stem + '-edited.json')
    with output_path.open('w') as f:
        f.write(b64_data)


if __name__ == "__main__":
    main()
